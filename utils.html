<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
</head>

<body>



<ul id="index">
  <li><a href="#SYNOPSIS">SYNOPSIS</a>
    <ul>
      <li><a href="#save_svirt_pty">save_svirt_pty</a></li>
      <li><a href="#type_line_svirt">type_line_svirt</a></li>
      <li><a href="#unlock_zvm_disk">unlock_zvm_disk</a></li>
      <li><a href="#handle_grub_zvm">handle_grub_zvm</a></li>
      <li><a href="#handle_untrusted_gpg_key">handle_untrusted_gpg_key</a></li>
      <li><a href="#integration_services_check_ip">integration_services_check_ip</a></li>
      <li><a href="#integration_services_check">integration_services_check</a></li>
      <li><a href="#unlock_if_encrypted">unlock_if_encrypted</a></li>
      <li><a href="#assert_gui_app">assert_gui_app</a></li>
      <li><a href="#check_console-font">check_console font</a></li>
      <li><a href="#type_string_slow_extended">type_string_slow_extended</a></li>
      <li><a href="#type_string_slow">type_string_slow</a></li>
      <li><a href="#type_string_very_slow">type_string_very_slow</a></li>
      <li><a href="#get_netboot_mirror">get_netboot_mirror</a></li>
      <li><a href="#zypper_call">zypper_call</a></li>
      <li><a href="#zypper_enable_install_dvd">zypper_enable_install_dvd</a></li>
      <li><a href="#zypper_ar">zypper_ar</a></li>
      <li><a href="#fully_patch_system">fully_patch_system</a></li>
      <li><a href="#ssh_fully_patch_system">ssh_fully_patch_system</a></li>
      <li><a href="#minimal_patch_system">minimal_patch_system</a></li>
      <li><a href="#workaround_type_encrypted_passphrase">workaround_type_encrypted_passphrase</a></li>
      <li><a href="#is_boot_encrypted">is_boot_encrypted</a></li>
      <li><a href="#is_bridged_networking">is_bridged_networking</a></li>
      <li><a href="#set_bridged_networking">set_bridged_networking</a></li>
      <li><a href="#set_hostname">set_hostname</a></li>
      <li><a href="#assert_and_click_until_screen_change">assert_and_click_until_screen_change</a></li>
      <li><a href="#handle_livecd_reboot_failure">handle_livecd_reboot_failure</a></li>
      <li><a href="#assert_screen_with_soft_timeout">assert_screen_with_soft_timeout</a></li>
      <li><a href="#pkcon_quit">pkcon_quit</a></li>
      <li><a href="#addon_decline_license">addon_decline_license</a></li>
      <li><a href="#addon_license">addon_license</a></li>
      <li><a href="#addon_products_is_applicable">addon_products_is_applicable</a></li>
      <li><a href="#noupdatestep_is_applicable">noupdatestep_is_applicable</a></li>
      <li><a href="#installwithaddonrepos_is_applicable">installwithaddonrepos_is_applicable</a></li>
      <li><a href="#random_string">random_string</a></li>
      <li><a href="#handle_emergency">handle_emergency</a></li>
      <li><a href="#service_action">service_action</a></li>
      <li><a href="#run_scripted_command_slow">run_scripted_command_slow</a></li>
      <li><a href="#get_root_console_tty">get_root_console_tty</a></li>
      <li><a href="#get_x11_console_tty">get_x11_console_tty</a></li>
      <li><a href="#arrays_differ">arrays_differ</a></li>
      <li><a href="#arrays_subset">arrays_subset</a></li>
      <li><a href="#ensure_serialdev_permissions">ensure_serialdev_permissions</a></li>
      <li><a href="#disable_serial_getty">disable_serial_getty</a></li>
      <li><a href="#exec_and_insert_password">exec_and_insert_password</a></li>
      <li><a href="#shorten_url">shorten_url</a></li>
      <li><a href="#handle_lofin_not_found">_handle_lofin_not_found</a></li>
      <li><a href="#reconnect_mgmt_console">reconnect_mgmt_console</a></li>
      <li><a href="#show_tasks_in_blocked_state-Dumps-tasks-that-are-in-uninterruptable-blocked-state-and-wait-for-headline-of-dump.-see:-https:-github.com-torvalds-linux-blob-master-Documentation-admin-guide-sysrq.rst">show_tasks_in_blocked_state Dumps tasks that are in uninterruptable (blocked) state and wait for headline of dump. see: https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/sysrq.rst</a></li>
      <li><a href="#svirt_host_basedir">svirt_host_basedir</a></li>
      <li><a href="#prepare_ssh_localhost_key_login">prepare_ssh_localhost_key_login</a></li>
      <li><a href="#script_retry">script_retry</a></li>
      <li><a href="#script_run_interactive">script_run_interactive</a></li>
      <li><a href="#create_btrfs_subvolume">create_btrfs_subvolume</a></li>
      <li><a href="#file_content_replace">file_content_replace</a></li>
    </ul>
  </li>
</ul>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<p>Main file for all kind of functions</p>

<h2 id="save_svirt_pty">save_svirt_pty</h2>

<p>save the pty device within the svirt shell session so that we can refer to the correct pty pointing to the first tty, e.g. for password entry for encrypted partitions and rewriting the network definition of zKVM instances.</p>

<p>Does <b>not</b> work on <b>Hyper-V</b>.</p>

<h2 id="type_line_svirt">type_line_svirt</h2>

<p>TODO someone should document this</p>

<h2 id="unlock_zvm_disk">unlock_zvm_disk</h2>

<p>TODO someone should document this</p>

<h2 id="handle_grub_zvm">handle_grub_zvm</h2>

<p>TODO someone should document this</p>

<h2 id="handle_untrusted_gpg_key">handle_untrusted_gpg_key</h2>

<p>TODO someone should document this</p>

<h2 id="integration_services_check_ip">integration_services_check_ip</h2>

<p>Check that guest IP address that host and guest see is the same.</p>

<h2 id="integration_services_check">integration_services_check</h2>

<p>Make sure integration services (e.g. kernel modules, utilities, services) are present and in working condition.</p>

<h2 id="unlock_if_encrypted">unlock_if_encrypted</h2>

<p>Check whether the system under test has an encrypted partition and attempts to unlock it.</p>

<h2 id="assert_gui_app">assert_gui_app</h2>

<p>assert_gui_app (optionally installs and) starts an application, checks it started and closes it again. It&#39;s the most minimalistic way to test a GUI application Mandatory parameter: application: the name of the application. Optional parameters are: install: boolean =&gt; does the application have to be installed first? Especially on live images where we want to ensure the disks are complete the parameter should not be set to true - otherwise we might mask the fact that the app is not on the media exec_param: string =&gt; When calling the application, pass this parameter on the command line remain: boolean =&gt; If set to true, do not close the application when tested it is running. This can be used if the application shall be tested further</p>

<h2 id="check_console-font">check_console font</h2>

<p>13.2, Leap 42.1, SLE12 GA&amp;SP1 have problems with setting up the console font, we need to call systemd-vconsole-setup to workaround that.</p>

<h2 id="type_string_slow_extended">type_string_slow_extended</h2>

<p>Enable additional arguments for nested calls of wait_still_screen</p>

<h2 id="type_string_slow">type_string_slow</h2>

<p>Typing a string with SLOW_TYPING_SPEED to avoid losing keys.</p>

<h2 id="type_string_very_slow">type_string_very_slow</h2>

<p>Typing a string even slower with VERY_SLOW_TYPING_SPEED</p>

<h2 id="get_netboot_mirror">get_netboot_mirror</h2>

<p>TODO someone should document this</p>

<h2 id="zypper_call">zypper_call</h2>

<p>function wrapping &#39;zypper -n&#39; with allowed return code, timeout and logging facility first parammeter is required command , all others are named and provided as hash for example : zypper_call(&quot;up&quot;, exitcode =&gt; [0,102,103], log =&gt; &quot;zypper.log&quot;); up -- zypper -n up -- update system exitcode -- allowed return code values log -- capture log and store it in zypper.log dumb_term -- pipes through cat if set to 1 and log is not set. This is a workaround to get output without any ANSI characters in zypper before 1.14.1. See boo#1055315.</p>

<h2 id="zypper_enable_install_dvd">zypper_enable_install_dvd</h2>

<p>Enables the install DVDs if they were used during the installation.</p>

<h2 id="zypper_ar">zypper_ar</h2>

<pre><code>    zypper_ar($url,[ name =&gt; NAME ], [ priority =&gt; N ]);</code></pre>

<p>Add repository (with zypper ar) unless it&#39;s already repo <code>$name</code> already added and refresh repositories.</p>

<p>Options:</p>

<p><code>$name</code> alias for repository, optional When used, additional check if repo not yet exists is done, and adding only if it doesn&#39;t exist. Also zypper ref is run only on this repository. NOTE: if not used, $url must be a URI pointing to a .repo file.</p>

<p><code>$no_gpg_check</code> pass --no-gpgcheck for repos with not valid GPG key, optional</p>

<p><code>$priority</code> set repo priority, optional</p>

<p><code>$params</code> other ar subcommand parameters, optional</p>

<p>Examples: zypper_ar(&#39;http://dist.nue.suse.com/ibs/QA:/Head/SLE-15-SP1&#39;, name =&gt; &#39;qa-head); zypper_ar(&#39;https://download.opensuse.org/repositories/devel:/kubic/openSUSE_Tumbleweed/devel:kubic.repo&#39;, no_gpg_check =&gt; 1, priority =&gt; 90);</p>

<h2 id="fully_patch_system">fully_patch_system</h2>

<p>TODO someone should document this</p>

<h2 id="ssh_fully_patch_system">ssh_fully_patch_system</h2>

<p>TODO someone should document this</p>

<h2 id="minimal_patch_system">minimal_patch_system</h2>

<p>zypper doesn&#39;t offer --updatestack-only option before 12-SP1, use patch for sp0 to update packager</p>

<h2 id="workaround_type_encrypted_passphrase">workaround_type_encrypted_passphrase</h2>

<pre><code>    workaround_type_encrypted_passphrase()</code></pre>

<p>Record soft-failure for unresolved feature fsc#320901 which we think is important and then unlock encrypted boot partitions if we expect it to be encrypted. This condition is met on &#39;storage-ng&#39; which by default puts the boot partition within the encrypted LVM same as in test scenarios where we explicitly create an LVM including boot (<code>FULL_LVM_ENCRYPT</code>). <code>ppc64le</code> was already doing the same by default also in the case of pre-storage-ng but not anymore for storage-ng.</p>

<h2 id="is_boot_encrypted">is_boot_encrypted</h2>

<p>TODO someone should document this</p>

<h2 id="is_bridged_networking">is_bridged_networking</h2>

<p>returns BRIDGED_NETWORKING</p>

<h2 id="set_bridged_networking">set_bridged_networking</h2>

<p>sets BRIDGED_NETWORKING if applicable</p>

<h2 id="set_hostname">set_hostname</h2>

<p>set_hostname($hostname);</p>

<p>Setting hostname according input parameter using hostnamectl. Calling <i>reload-or-restart</i> to make sure that network stack will propogate hostname into DHCP/DNS</p>

<p>if you change hostname using <code>hostnamectl set-hostname</code>, then <code>hostname -f</code> will fail with <i>hostname: Name or service not known</i> also DHCP/DNS don&#39;t know about the changed hostname, you need to send a new DHCP request to update dynamic DNS yast2-network module does <code>NetworkService.ReloadOrRestart if Stage.normal || !Linuxrc.usessh</code> if hostname is changed via <code>yast2 lan</code></p>

<h2 id="assert_and_click_until_screen_change">assert_and_click_until_screen_change</h2>

<p>TODO someone should document this</p>

<h2 id="handle_livecd_reboot_failure">handle_livecd_reboot_failure</h2>

<p>Handle a potential failure on a live CD related to boo#993885 that the reboot action from a desktop session does not work and we are stuck on the desktop.</p>

<h2 id="assert_screen_with_soft_timeout">assert_screen_with_soft_timeout</h2>

<pre><code>  assert_screen_with_soft_timeout($mustmatch [,timeout =&gt; $timeout] [, bugref =&gt; $bugref] [,soft_timeout =&gt; $soft_timeout] [,soft_failure_reason =&gt; $soft_failure_reason]);</code></pre>

<p>Extending assert_screen with a soft timeout. When <code>$soft_timeout</code> is hit, a soft failure is recorded with the message <code>$soft_failure_reason</code> but assert_screen continues until the (hard) timeout <code>$timeout</code> is hit. This makes sense when an assert screen should find a screen within a lower time but still should not fail and continue until the hard timeout, e.g. to discover performance issues.</p>

<p>Example:</p>

<pre><code>  assert_screen_with_soft_timeout(&#39;registration-found&#39;, timeout =&gt; 300, soft_timeout =&gt; 60, bugref =&gt; &#39;bsc#123456&#39;);</code></pre>

<h2 id="pkcon_quit">pkcon_quit</h2>

<p>TODO someone should document this</p>

<h2 id="addon_decline_license">addon_decline_license</h2>

<p>TODO someone should document this</p>

<h2 id="addon_license">addon_license</h2>

<p>TODO someone should document this</p>

<h2 id="addon_products_is_applicable">addon_products_is_applicable</h2>

<p>TODO some should document this</p>

<h2 id="noupdatestep_is_applicable">noupdatestep_is_applicable</h2>

<p>TODO someone should document this</p>

<h2 id="installwithaddonrepos_is_applicable">installwithaddonrepos_is_applicable</h2>

<p>TODO someone should document this</p>

<h2 id="random_string">random_string</h2>

<p>returns a random string</p>

<h2 id="handle_emergency">handle_emergency</h2>

<p>Handle emergency mode</p>

<h2 id="service_action">service_action</h2>

<pre><code>  service_action($service_name [, {type =&gt; [&#39;$unit_type&#39;, ...] [,action =&gt; [&#39;$service_action&#39;, ...]]}]);</code></pre>

<p>Control systemd services. <code>type</code> may be set to service, socket, ... and <code>$action</code> to start, stop, ... Default action is to &#39;stop&#39; $service_name.service unit file.</p>

<p>Example:</p>

<pre><code>  service_action(&#39;dbus&#39;, {type =&gt; [&#39;socket&#39;, &#39;service&#39;], action =&gt; [&#39;unmask&#39;, &#39;start&#39;]});</code></pre>

<h2 id="run_scripted_command_slow">run_scripted_command_slow</h2>

<pre><code>    run_scripted_command_slow($cmd [, slow_type =&gt; &lt;num&gt;]);</code></pre>

<p>Type slowly to run very long command in scripted way to avoid issue of &#39;key event queue full&#39; (see poo#12250). Pass optional slow_type key to control how slow to type the command. Scripted very long command to shorten typing length. Default slow_type is type_string_slow.</p>

<h2 id="get_root_console_tty">get_root_console_tty</h2>

<p>Returns tty number used designed to be used for root-console. When console is not yet initialized, we cannot get it from arguments. Since SLE 15 gdm is running on tty2, so we change behaviour for it and openSUSE distris, except for Xen PV (bsc#1086243).</p>

<h2 id="get_x11_console_tty">get_x11_console_tty</h2>

<p>Returns tty number used designed to be used for X. Since SLE 15 gdm is always running on tty7, currently the main GUI session is running on tty2 by default, except for Xen PV and Hyper-V (bsc#1086243). See also: bsc#1054782</p>

<h2 id="arrays_differ">arrays_differ</h2>

<p>Comparing two arrays passed by reference. Return 1 if arrays has symmetric difference and 0 otherwise.</p>

<h2 id="arrays_subset">arrays_subset</h2>

<pre><code>    arrays_subset(\@array1, \@array2);</code></pre>

<p>Compares two arrays passed by reference to identify if array1 is a subset of array2.</p>

<p>Returns resulting array containing items of array1 that do not exist in array2. If all the items of array1 exist in array2, returns an empty array (which means array1 is a subset of array2).</p>

<h2 id="ensure_serialdev_permissions">ensure_serialdev_permissions</h2>

<p>Grant user permission to access serial port immediately as well as persisting over reboots. Used to ensure that testapi calls like script_run work for the test user as well as root.</p>

<h2 id="disable_serial_getty">disable_serial_getty</h2>

<p>Serial getty service pollutes serial output with login propmt, which interferes with the output, e.g. when calling script_output. Login prompt messages on serial are used on some remote backend to identify that system has been booted, so do not mask on non-qemu backends</p>

<h2 id="exec_and_insert_password">exec_and_insert_password</h2>

<pre><code>    exec_and_insert_password($cmd);

 1. Execute a command that ask for a password
 2. Detects password prompt
 3. Insert password and hits enter</code></pre>

<h2 id="shorten_url">shorten_url</h2>

<p>Shorten url via schort(s.qa.suse.de) This is mainly used for autoyast url shorten to avoid limit of x3270 xedit</p>

<h2 id="handle_lofin_not_found">_handle_lofin_not_found</h2>

<p>TODO someone should document this</p>

<h2 id="reconnect_mgmt_console">reconnect_mgmt_console</h2>

<p>After each reboot we have to reconnect to the management console on remote backends</p>

<h2 id="show_tasks_in_blocked_state-Dumps-tasks-that-are-in-uninterruptable-blocked-state-and-wait-for-headline-of-dump.-see:-https:-github.com-torvalds-linux-blob-master-Documentation-admin-guide-sysrq.rst">show_tasks_in_blocked_state Dumps tasks that are in uninterruptable (blocked) state and wait for headline of dump. see: https://github.com/torvalds/linux/blob/master/Documentation/admin-guide/sysrq.rst</h2>

<h2 id="svirt_host_basedir">svirt_host_basedir</h2>

<p>TODO someone should document this</p>

<h2 id="prepare_ssh_localhost_key_login">prepare_ssh_localhost_key_login</h2>

<p>TODO someone should document this</p>

<h2 id="script_retry">script_retry</h2>

<p>Repeat command until expected result or timeout script_retry &#39;ping -c1 -W1 machine&#39;, retry =&gt; 5</p>

<h2 id="script_run_interactive">script_run_interactive</h2>

<pre><code>    script_run_interactive($cmd, $prompt, $timeout);</code></pre>

<p>For interactive command, input strings or keys according to the prompt message in the run time. Pass arrayref $prompt which contains the prompt message to be matched (regex) and the answer with string or key to be typed. for example:</p>

<pre><code>    [{
        prompt =&gt; qr/\(A\)llow/m,
        key    =&gt; &#39;a&#39;,
      },
      {
        prompt =&gt; qr/Enter Password or Pin/m,
        string =&gt; &quot;testpasspw\n&quot;,
      },]</code></pre>

<p>A &quot;EOS~~~&quot; message followed by return value will be printed as a mark for the end of interaction after the command finished running.</p>

<p>If the first argument is undef, only the sencond part will be processed - to match output and react. If the second argument is undef, the first part will be processed - to run the command without interaction with terminal output. This is useful for some situation when you want to do more between inputing command and the following interaction, eg. switch TTYs or detach the screen.</p>

<h2 id="create_btrfs_subvolume">create_btrfs_subvolume</h2>

<p>create btrfs subvolume for /boot/grub2/arm64-efi before migration. ref:bsc#1122591</p>

<h2 id="file_content_replace">file_content_replace</h2>

<pre><code>  file_content_replace(&quot;filename&quot;,
        regex_to_find =&gt; text_to_replace,
        &#39;--sed-modifier&#39; =&gt; &#39;g&#39;,
        &#39;another^&amp;&amp;*(textToFind&#39; =&gt; &quot;replacement&quot;)

  generify sed usage as config file modification tool.
  allow to modify several items in one function call
  by providing  regex_to_find / text_to_replace as hash key/value pairs

  special key &#39;--sed-modifier&#39; allowing to add modifiers to expression
  special key &#39;--debug&#39; allow to output full file content into serial. Disabled
  by default</code></pre>


</body>

</html>


